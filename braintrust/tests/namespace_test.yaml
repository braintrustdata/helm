suite: test namespace template and helper
templates:
  - namespace.yaml
tests:
  - it: should not render namespace when createNamespace is false
    set:
      global.createNamespace: false
      global.namespace: "braintrust"
    asserts:
      - hasDocuments:
          count: 0

  - it: should render namespace when createNamespace is true
    set:
      global.createNamespace: true
      global.namespace: "my-namespace"
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Namespace
      - equal:
          path: metadata.name
          value: my-namespace
      - equal:
          path: metadata.labels.name
          value: my-namespace

  - it: should include global labels in namespace
    set:
      global.createNamespace: true
      global.namespace: "test-ns"
      global.labels.environment: "production"
      global.labels.team: "platform"
    asserts:
      - equal:
          path: metadata.labels.environment
          value: production
      - equal:
          path: metadata.labels.team
          value: platform

  - it: should include namespace annotations
    set:
      global.createNamespace: true
      global.namespace: "test-ns"
      global.namespaceAnnotations.custom-annotation: "value"
    asserts:
      - equal:
          path: metadata.annotations["custom-annotation"]
          value: value

  - it: should include azure workload identity annotation when cloud is azure
    set:
      cloud: "azure"
      global.createNamespace: true
      global.namespace: "test-ns"
    asserts:
      - equal:
          path: metadata.annotations["azure.workload.identity/use"]
          value: "true"

  - it: should not include azure workload identity annotation when cloud is not azure
    set:
      cloud: "google"
      global.createNamespace: true
      global.namespace: "test-ns"
    asserts:
      - isNull:
          path: metadata.annotations["azure.workload.identity/use"]
