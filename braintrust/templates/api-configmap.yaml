---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.api.name }}
  namespace: {{ .Values.global.namespace }}
data:
  ORG_NAME: {{ .Values.global.orgName | quote }}
  {{- if eq .Values.cloud "azure" }}
  RESPONSE_BUCKET: {{ .Values.objectStorage.azure.storageAccountName | quote }}
  RESPONSE_BUCKET_PREFIX: {{ .Values.objectStorage.azure.responseContainer | quote }}
  CODE_BUNDLE_BUCKET: {{ .Values.objectStorage.azure.storageAccountName | quote }}
  CODE_BUNDLE_BUCKET_PREFIX: {{ .Values.objectStorage.azure.codeBundleContainer | quote }}
  {{- else }}
  RESPONSE_BUCKET: {{ .Values.objectStorage.aws.responseBucket | quote }}
  CODE_BUNDLE_BUCKET: {{ .Values.objectStorage.aws.codeBundleBucket | quote }}
  {{- end }}
  ALLOW_CODE_FUNCTION_EXECUTION: {{ .Values.api.allowCodeFunctionExecution | quote }}
  {{- if eq .Values.cloud "azure" }}
  BRAINSTORE_REALTIME_WAL_BUCKET: {{ .Values.objectStorage.azure.storageAccountName | quote }}
  BRAINSTORE_REALTIME_WAL_BUCKET_PREFIX: "{{ .Values.objectStorage.azure.brainstoreContainer }}/wal"
  {{- else }}
  BRAINSTORE_REALTIME_WAL_BUCKET: {{ .Values.objectStorage.aws.brainstoreBucket | quote }}
  BRAINSTORE_REALTIME_WAL_BUCKET_PREFIX: "brainstore/wal"
  {{- end }}
  BRAINSTORE_ENABLED: {{ .Values.brainstore.enabled | quote }}
  BRAINSTORE_URL: "http://{{ .Values.brainstore.name }}:{{ .Values.brainstore.service.port }}"
  BRAINSTORE_ENABLE_HISTORICAL_FULL_BACKFILL: {{ .Values.api.enableHistoricalFullBackfill | quote }}
  BRAINSTORE_BACKFILL_NEW_OBJECTS: {{ .Values.api.backfillNewObjects | quote }}
  BRAINSTORE_BACKFILL_DISABLE_HISTORICAL: {{ .Values.api.backfillDisableHistorical | quote }}
  BRAINSTORE_BACKFILL_DISABLE_NONHISTORICAL: {{ .Values.api.backfillDisableNonhistorical | quote }}
